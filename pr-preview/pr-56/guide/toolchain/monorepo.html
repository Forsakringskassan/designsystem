<!doctype html>
<html lang="sv" class="layout--content-with-menu" data-root-url="../..">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Monorepo - FK Designsystem</title>

        <!-- prettier-ignore -->
        <link
            rel="stylesheet"
            href="../../assets/docs-e0340d.css"
            crossorigin
            integrity="sha384-smlrMBfvoL0wlSlp2WfbyMfsTNVIeguTCveS5kBS8vnlDLgNmknojOd2o34hD4Yz"
            
        />
        <link
            rel="stylesheet"
            href="../../assets/docs-exp-20bffd.css"
            crossorigin
            integrity="sha384-6BYFbCDF9Kpkrzho3lx0NSarN4IA63v7JvNMIIePBpnokKAl9zFH1vuQ/ma+hR6q"
            data-theme="exp" disabled
        />
        <link
            rel="stylesheet"
            href="../../assets/docs-int-eb68cb.css"
            crossorigin
            integrity="sha384-ODo1c8cooTCxBx4YigL/vwFNWOW1pD+yHqLYtWPL0jknUfY51p4y8o6380l8Okei"
            data-theme="int" disabled
        />

        <!-- prettier-ignore -->
        <script
            src="../../assets/bootstrap-956ec3.js"
            crossorigin
            integrity="sha384-xxAJqJoQn4hXyrxMhtQL+Vf9cvR79mtI9cjQwcm4awdJR3rcJZo1/+24cjUnFmfe"
            
        ></script>

        <!-- prettier-ignore -->
        <script>
    function themeRenderBlocker() {
        const theme = window.localStorage.getItem("fkds-theme") ?? "exp";
        const style = Array.from(document.querySelectorAll("[data-theme]"));
        for (const el of style) {
            el.disabled = el.dataset.theme !== theme;
        }
    }

    themeRenderBlocker();
</script>
<script>
    (() => {
        withCookieConsent(() =>  {
            const allowedHostnames = [
  "designsystem.forsakringskassan.se",
  "designsystem.fk.se",
  "ds.fk.se",
  "forsakringskassan.github.io"
];
            if (allowedHostnames.length === 0 || allowedHostnames.includes(location.hostname)) {
                /* Matomo */
                var _paq = (window._paq = window._paq || []);
                
                _paq.push(["trackPageView"]);
                _paq.push(["enableLinkTracking"]);
                (function () {
                    var u = "https://webstats.forsakringskassan.se/matomo/";
                    _paq.push(["setTrackerUrl", u + "matomo.php"]);
                    _paq.push(["setSiteId", "19"]);
                    var d = document,
                        g = d.createElement("script"),
                        s = d.getElementsByTagName("script")[0];
                    g.async = true;
                    g.src = u + "matomo.js";
                    s.parentNode.insertBefore(g, s);
                })();
                /* End Matomo Code */
            } else {
                console.error(
                    "Matomo analytics disabled as we are not running on one of the configured hostnames",
                    allowedHostnames,
                );
            }
        });
    })();
</script>


        <link
            rel="preload"
            href="../../search-data-23e839.json"
            as="fetch"
            crossorigin
            integrity="sha384-kcDZ9XdK7TbeTobr0aDpsmFSPz7rslUYB4ob7Oi9rlZkrjJzjQpTev37vr7nLVho"
            id="search-data"
        />
    </head>
    <body>
        <!-- prettier-ignore -->
        
<template id="motd-message">
<div class="docs-motd docs-motd--info">
    <span class="docs-motd__icon">
        <span class="icon-stack icon-stack--info">
            <svg class="icon icon--circle" focusable="false" aria-hidden="true">
                <use xlink:href="#docs-icon-circle"></use>
            </svg>
            <svg class="icon icon--i" focusable="false" aria-hidden="true">
                <use xlink:href="#docs-icon-i"></use>
            </svg>
        </span>
    </span><span data-bind="screenreader" class="sr-only"></span>
    <p data-bind="message"></p></div>
</template>


<div id="motd-container">
    </div>
<div class="cookie-warning">
    <!-- [html-validate-disable-next heading-level, no-unused-disable -- allowed sectioning root] -->
    <h1>Kakor på webbplatsen</h1>
    <p>
        Vi använder kakor (cookies) för att webbplatsen ska fungera så bra som möjligt för dig.<br />
        Vi använder också kakor för webbanalys för att göra webbplatsen bättre.
    </p>
    <p>Godkänner du att vi också använder kakor för webbanalys?</p>

    <div class="button-group">
        <button id="consent-all-button" class="button button-group__item button--primary" type="button">
            Ja, jag godkänner alla kakor
        </button>

        <button id="consent-functional-button" class="button button-group__item button--secondary" type="button">
            Nej, jag godkänner bara nödvändiga kakor
        </button>
    </div>
</div>


        <div class="layout-wrapper">
            <header>
                <!-- prettier-ignore --><div class="page-header__root">
    <div class="page-header">
        <a class="page-header__logo" href="../../index.html">
            <span aria-label="FK Designsystem" role="img" class="page-header__logo--small"> </span>
        </a>
        <a class="page-header__app-name" href="../../index.html"> FK Designsystem </a>
        <div class="page-header__right"><nav id="topnav" class="docs-topnav" aria-label="Primär">
    <ul class="docs-topnav__list">
        <!-- prettier-ignore -->
        
        
        
        <li class="docs-topnav__item ">
            <a class="docs-topnav__anchor" href="../../gettingstarted/"> Kom igång </a>
        </li>
        
        
        
        
        <li class="docs-topnav__item ">
            <a class="docs-topnav__anchor" href="../../components/"> Komponenter </a>
        </li>
        
        
        
        
        <li class="docs-topnav__item ">
            <a class="docs-topnav__anchor" href="../../guides/"> Guider </a>
        </li>
        
        
        
        
        <li class="docs-topnav__item ">
            <a class="docs-topnav__anchor" href="../../functions/"> Funktioner </a>
        </li>
        
        
        
        
        <li class="docs-topnav__item ">
            <a class="docs-topnav__anchor" href="../../styles/"> Visuellt </a>
        </li>
        <li class="docs-topnav__item docs-topnav__item--more" style="visibility: hidden">
            <button type="button" class="docs-topnav__anchor" aria-expanded="false">
                <span>Mer</span>
                <svg class="icon" focusable="false" aria-hidden="true">
                    <use xlink:href="#docs-icon-arrow-down"></use>
                </svg>
            </button>
            <div class="docs-contextmenu">
                <ul class="docs-contextmenu__list">
                    <!-- prettier-ignore -->
                    
                    
                    
                    <li class="docs-contextmenu__item " style="display: none">
                        <a class="docs-contextmenu__anchor" href="../../gettingstarted/"> Kom igång </a>
                    </li>
                    
                    
                    
                    
                    <li class="docs-contextmenu__item " style="display: none">
                        <a class="docs-contextmenu__anchor" href="../../components/"> Komponenter </a>
                    </li>
                    
                    
                    
                    
                    <li class="docs-contextmenu__item " style="display: none">
                        <a class="docs-contextmenu__anchor" href="../../guides/"> Guider </a>
                    </li>
                    
                    
                    
                    
                    <li class="docs-contextmenu__item " style="display: none">
                        <a class="docs-contextmenu__anchor" href="../../functions/"> Funktioner </a>
                    </li>
                    
                    
                    
                    
                    <li class="docs-contextmenu__item " style="display: none">
                        <a class="docs-contextmenu__anchor" href="../../styles/"> Visuellt </a>
                    </li>
                    </ul>
            </div>
        </li>
    </ul>
</nav>

            <div class="page-header__right-slot">
                <div class="toolbar"><div class="toolbar__item">
    <form id="search" role="search">
        <button class="text-field__input" type="submit">
            <svg focusable="false" class="icon button__icon">
                <use xlink:href="#docs-icon-search"></use></svg
            >Sök <kbd>ctrl-k</kbd>
        </button>
    </form>
</div>
<div class="toolbar__item">
    <div class="select-field" style="visibility: hidden">
        <label for="fkds-theme-select" class="label sr-only"> Tema </label>
        <div class="select-field__icon-wrapper">
            <select id="fkds-theme-select" class="select-field__select">
                <option value="exp">Försäkringskassan</option>
                <option value="int">FK Hapo</option>
            </select>
            <svg focusable="false" class="icon select-field__icon">
                <use xlink:href="#docs-icon-arrow-down"></use>
            </svg>
        </div>
    </div>

    <script>
        function themeSelector() {
            function getSelectedTheme(key) {
                return window.localStorage.getItem(key) ?? "exp";
            }

            function saveSelectedTheme(key, value) {
                window.localStorage.setItem(key, value);
            }

            function enableTheme(theme) {
                const style = Array.from(document.querySelectorAll("[data-theme]"));
                for (const el of style) {
                    el.disabled = el.dataset.theme !== theme;
                }
            }

            const el = document.querySelector("#fkds-theme-select");
            const wrapper = /** @type {HTMLElement} */ (el.closest(".select-field"));
            el.addEventListener("change", () => {
                const theme = el.value;
                saveSelectedTheme("fkds-theme", theme);
                enableTheme(theme);
            });

            const selected = getSelectedTheme("fkds-theme");
            enableTheme(selected);
            el.value = selected;

            wrapper.style.visibility = null;
        }

        themeSelector();
    </script>
</div>
</div>
            </div>
        </div>
    </div>
</div>
</header>

            <div id="primary">
                <!-- prettier-ignore -->
<div id="sidenav">
<input type="checkbox" class="sidenav__toggle" aria-label="Open/close navigation" />
<nav class="navigation" aria-label="Sekundär">
<ol>
    <!-- prettier-ignore --><!-- prettier-ignore -->
    <li class="expandable active">
        <details open>
            <summary>Toolchain</summary>
            <!-- prettier-ignore -->
            
            
<ol>
    <!-- prettier-ignore --><!-- prettier-ignore -->
    <!-- prettier-ignore -->
    <li class="link ">
        <!-- prettier-ignore -->
        <a
            href="./"
            
        >
            Toolchain
        </a>
    </li><!-- prettier-ignore --><!-- prettier-ignore -->
    <!-- prettier-ignore -->
    <li class="link active">
        <!-- prettier-ignore -->
        <a
            href="./monorepo.html"
            
        >
            Monorepo
        </a>
    </li><!-- prettier-ignore --><!-- prettier-ignore -->
    <!-- prettier-ignore -->
    <li class="link ">
        <!-- prettier-ignore -->
        <a
            href="./api-design.html"
            
        >
            API design
        </a>
    </li><!-- prettier-ignore --><!-- prettier-ignore -->
    <!-- prettier-ignore -->
    <li class="link ">
        <!-- prettier-ignore -->
        <a
            href="./byggscript.html"
            
        >
            Byggscript
        </a>
    </li><!-- prettier-ignore --><!-- prettier-ignore -->
    <!-- prettier-ignore -->
    <li class="link ">
        <!-- prettier-ignore -->
        <a
            href="./dokumentation.html"
            
        >
            Dokumentation
        </a>
    </li><!-- prettier-ignore --><!-- prettier-ignore -->
    <!-- prettier-ignore -->
    <li class="link ">
        <!-- prettier-ignore -->
        <a
            href="./pakethantering.html"
            
        >
            Pakethantering
        </a>
    </li><!-- prettier-ignore --></ol>

            
        </details>
    </li><!-- prettier-ignore -->
    <!-- prettier-ignore --></ol>
</nav>
</div>


                <!-- prettier-ignore -->
                <script
                    src="../../assets/vendor-vue-468cb1.js"
                    crossorigin
                    integrity="sha384-KKjiOjaw6Q5fH4WnjR/Bs1bYIxZ/yOxDk3Wtk665LIZMMavXzSWZawkLXt4Xqv48"
                ></script>
                <script
                    src="../../assets/vendor-fkui-logic-80bead.js"
                    crossorigin
                    integrity="sha384-Z2/NqF6ePc4T4iMz6PwSDLkLmvLhbK5QZLGHd8KpTPVYnnXi2X3zc0IfKPQ5pE07"
                ></script>
                <script
                    src="../../assets/vendor-fkui-date-9b7c35.js"
                    crossorigin
                    integrity="sha384-XgTn6yWRIVTQ33nFXLN5K2ZaFcovqJYAUXIhhFPsvsyWe3HAizwpv5WRjT6S1vOM"
                ></script>
                <script
                    src="../../assets/vendor-fkui-vue-eb2549.js"
                    crossorigin
                    integrity="sha384-T3qCfAVI6bEBLVnBfj/fECjLZoJRsfvYnCgP6VXARpnWFrX46x8lOyOgEmb3Vu/L"
                ></script>
                <script
                    src="../../assets/vendor-forsakringskassan-docs-live-example-31bc18.js"
                    crossorigin
                    integrity="sha384-nSXnCy3XWIIfbEbIXNEJqSLQAEcC9s8jxUGnIw/HClLMcJP8KJDSvkJw7vxe9PgF"
                ></script>

                <!-- prettier-ignore --><main>
                    <!-- [html-validate-disable-next heading-level, no-unused-disable -- allowed sectioning root] -->
                    <h1 id="title">Monorepo</h1>

                    

                    <div id="content">
                        <!-- prettier-ignore -->
<p>Källkoden för FKUI är strukturerad i ett monorepo.
Det innebär att vi från ett och samma repo levererar flera leverabler (paket), dess versionsnummer är i synk med varandra samt att vi snabbt kan testa ändringar som slår över flera paket.</p>
<p>Så här jobbar vi i monorepo</p>
<h2 id="versioner"><a class="header-anchor" href="#versioner">Versioner</a></h2><p>I FKUI så är använder vi <a href="https://semver.org/">semantisk versionshantering</a> och versioner som är i synk med varandra.
Det innebär att konsumenten vet att om man har version X.Y (exempelvis v5.1) av samtliga FKUI-paket så är de testade tillsammans och fungerar de alltid ihop.</p>
<ul>
<li>Major versioner innehåller alltid brytande ändringar, oftast innebär detta att kodförändringar krävs men även förändrat SLA (exempelvis att IE11 stöd togs bort) innebär en brytande ändring.</li>
<li>Minor versioner innehåller nya features men inget som kräver förändringar hos konsumenten, alla ändringar är bakåtkompertibla. Uppstår det trots allt förändringar som kräver ändringar ska detta ses som en bugg.</li>
<li>Patch versioner innehåller enbart buggrättningar och här kan olika paket få olika patch-versioner, exempelvis 5.1.0 och 5.1.2 fungerar fortfarande ihop.</li>
</ul>
<p>Versioner hanteras automatiskt vid release utifrån commitmeddelanden.</p>
<ul>
<li>Läs mer om <a href="#release">releasehantering</a>.</li>
<li>Läs mer om <a href="#commits">commitmeddelanden</a>.</li>
</ul>
<h2 id="katalogstruktur"><a class="header-anchor" href="#katalogstruktur">Katalogstruktur</a></h2><p>I FKUI så använder vi följande katalogstruktur:</p>

                <div
                    id="example-31cda5"
                    class="code-preview code-preview--default"
                    
                    
                    data-language=""
                >
                    
                    <pre class="code-preview__markup"><code>(root)
├── cypress
├── docs
├── etc
├── internal
│   ├── pkg-a
│   └── pkg-b
├── packages
│   ├── pkg-c
│   └── pkg-d
└── scripts
</code></pre>
                </div>
            <p>där:</p>
<ul>
<li><code>cypress</code> innehåller konfiguration och gemensamma E2E testfall. Läs mer om <a href="#testfall">testfall</a>.</li>
<li><code>docs</code> innehåller dokumentation och innehåll för denna siten. Läs mer om <a href="#dokumentation">dokumentation</a>.</li>
<li><code>etc</code> innehåller automatgenererade API deklarationer och manifest. Läs mer om <a href="#byggscript">byggscript</a>.</li>
<li><code>internal</code> innehåller interna paket, paket som inte publiceras extern men kan användas av andra paket.</li>
<li><code>packages</code> innehåller publika paket, paket som publiceras och kan användas av konsumenter.</li>
<li><code>scripts</code> innehåller gemensamma script för byggen och underhåll av repository.</li>
</ul>
<p>Namnsättningen för paket i <code>internal</code> och <code>packages</code> är att katalogens namn ska motsvara namnet i <code>package.json</code> utan scope, dvs om paketet har namnet <code>@fkui/foo-bar</code> ska katalogen ha namnet <code>foo-bar</code>.
Varje paket innehåller en egen <code>package.json</code> där paketets metadata, script och beroenden definieras.</p>
<p>Det mesta av utvecklingsarbetet sker i <code>packages</code>.</p>
<h2 id="npm_script"><a class="header-anchor" href="#npm_script">NPM script</a></h2><p>TODO: ändra &quot;kommando&quot; till &quot;script&quot;</p>
<p>Vi kör primärt alla kommandon direkt från root, endast i undantagsfall anropar vi något från en djupare katalog.</p>
<p>Många kommandon kan köras för hela monorepot direkt:</p>
<ul>
<li><code>npm install</code> / <code>npm ci</code>: installerar beroenden för samtliga paket.</li>
<li><code>npm test</code> kör enhetstester, statisk kodanalys och lintning.</li>
<li><code>npm run build</code> bygger samtliga paket.</li>
<li><code>npm exec cypress open</code> startar cypress.</li>
</ul>
<h3 id="npm_install"><a class="header-anchor" href="#npm_install">NPM Install</a></h3><p>Vi kör alltid <a href="https://docs.npmjs.com/cli/v10/commands/npm-install"><code>npm install</code></a> (eller det besläktade <a href="https://docs.npmjs.com/cli/v10/commands/npm-ci"><code>npm ci</code></a>) från root i monorepot.
Det kan orsaka problem i din miljö om du försöker köra <code>npm install</code> från en underkatalog (framförallt så bryts symlänkar till andra paket i monorepot och man jobbar därför mot gamla kopior och inte mot den faktiska koden i monorepot).
Senare version av <code>npm install</code> känner av att det körs från en underkatalog och agerar som att du hade kört från root men vi rekommenderar att alltid ha som vana att köra alla kommandon från root speciellt kommandon så som <code>npm install</code> som kan orsaka problem.</p>
<p>I ett monorepo kan det finnas flera <code>node_modules</code> kataloger.
<code>npm install</code> kommer försöka att lägga alla beroenden i rootens <code>node_modules</code> (deduplication) men om det uppstår konflikter i versioner mellan två paket i monorepot kan den skapa upp djupare <code>node_modules</code> kataloger exempelvis <code>packages/vue/node_modules</code>.
Det kan exempelvis se ut så här:</p>

                <div
                    id="example-d3f973"
                    class="code-preview code-preview--default"
                    
                    
                    data-language=""
                >
                    
                    <pre class="code-preview__markup"><code>(root)
├── node_modules
│   ├── dep-a
│   ├── dep-b                 # dep-b v1
│   └── dep-c
└── packages
    └── vue
        └── node_modules
            └── dep-b         # dep-b v2
</code></pre>
                </div>
            <p>När vi i koden använder <code>require</code> eller <code>import</code> så kommer både paketets egna <code>node_modules</code> och rootens <code>node_modules</code> katalog att användas.
(Rent tekniskt letar <code>require</code> och <code>import</code> rekursivt i filsystemet efter alla <code>node_modules</code> kataloger den kan nå.)</p>
<p>I rootens <code>node_modules</code> kommer också symlänkar mot monorepots paket skapas upp.</p>

                <div
                    id="example-bcbe87"
                    class="code-preview code-preview--default"
                    
                    
                    data-language=""
                >
                    
                    <pre class="code-preview__markup"><code>(root)
└── node_modules
    └── @fkui
        ├── logic -&gt; packages/logic
        └── vue -&gt; packages/vue
</code></pre>
                </div>
            <p>Detta möjliggör för <code>require</code> och <code>import</code> att hitta paketen trots att de egentligen inte är installerade och att de alltid pekar ut det som ligger i monorepot istället för föregående släppt version.</p>
<blockquote>
<p>Notera: symlänken pekar bara ut var i monorepot paketet finns. För att paketet ska kunna importeras med <code>require</code> eller <code>import</code> måste paketet också byggas (så leverabler i respektive <code>lib</code> katalog skapas). Läs mer om att <a href="./byggscript.html">bygga paket</a>.</p>
</blockquote>
<p>För utvecklingsmiljöer använder vi primärt <a href="https://docs.npmjs.com/cli/v10/commands/npm-install"><code>npm install</code></a>.
Den behåller de existerande <code>node_modules</code> katalogerna och installerar det som är nytt samt att den uppdaterar <code>package-lock.json</code> om den inte är i synk med <code>package.json</code>.</p>
<p>För CI-miljöer eller om man vill säkerställa att man har en ren miljö använder vi <a href="https://docs.npmjs.com/cli/v10/commands/npm-ci"><code>npm ci</code></a> (clean install).
Skillnaden mot <code>install</code> är att <code>ci</code> tömmer existerande <code>node_modules</code> och undviker att beräkna om beroendeträdet genom att enbart läsa <code>package-lock.json</code>.</p>
<p><code>npm install</code> används också för att installera nya beroenden.
Läs mer om att <a href="./pakethantering.html#beroenden">installera beroenden</a>.</p>
<h3 id="workspaces"><a class="header-anchor" href="#workspaces">Workspaces</a></h3><p>Eftersom många kommandon tar relativt långt tid att köra är det ofta fördelaktigt att köra det för ett enskilt paket.
Med <code>npm run --workspace PAKET</code> (kort <code>-w</code>) kan vi anropa script för ett eller flera paket exempelvis:</p>

                <div
                    id="example-dd7d52"
                    class="code-preview code-preview--default"
                    
                    
                    data-language="bash"
                >
                    
                    <pre class="code-preview__markup"><code class="hljs lang-bash" tabindex="0">npm run -w @fkui/vue build
</code></pre>
                </div>
            <blockquote>
<p>OBS! Vid byggen av individuella paket har vi ingen automatiskt detektering av att dess beroenden är byggda. De paketeten behöver byggas först eller så måste ett fullständigt bygge göras.</p>
</blockquote>
<p>Det går också att köra script för alla paket med <code>--workspaces</code> (kort <code>-ws</code>, notera plural).
Detta kan med fördel kombineras med <code>--if-present</code> som enbart kör scriptet om det finns definierat i paketets <code>package.json</code>.</p>

                <div
                    id="example-802856"
                    class="code-preview code-preview--default"
                    
                    
                    data-language="bash"
                >
                    
                    <pre class="code-preview__markup"><code class="hljs lang-bash" tabindex="0">npm run -ws --if-present unit
</code></pre>
                </div>
            <p>Både <code>--workspace</code> och <code>workspaces</code> kan användas för de flesta NPM kommandon, bland annat:</p>
<ul>
<li><code>npm install -w @fkui/logic foobar</code>: installerar beroendet <code>foobar</code> i <code>@fkui/logic</code>.</li>
<li><code>npm test -w @fkui/date</code>: kör testfall för <code>@fkui/date</code>.</li>
<li><code>npm start -w @fkui/vue</code>: startar utvecklingsmiljö för <code>@fkui/vue</code>.</li>
<li>osv</li>
</ul>
<p>Om än både <code>npm run test</code> och <code>npm run start</code> fungerar använder vi med fördel dess alias <code>npm test</code> samt <code>npm start</code>.</p>
<h3 id="parametrar"><a class="header-anchor" href="#parametrar">Parametrar</a></h3><p>Behöver man ange extra parametrar till något script måste man använda <code>--</code> före parametrar:</p>

                <div
                    id="example-1d2a6d"
                    class="code-preview code-preview--default"
                    
                    
                    data-language="bash"
                >
                    
                    <pre class="code-preview__markup"><code class="hljs lang-bash" tabindex="0">npm run unit -w @fkui/vue -- --no-coverage -u
</code></pre>
                </div>
            <p>Utan <code>--</code> kommer parametrarna att skickas till <code>npm run</code> istället för det kommando som anropas av scriptet.</p>
<h3 id="exec"><a class="header-anchor" href="#exec">Exec</a></h3><p>Vissa NPM paket (beroenden) kommer med egna körbara script.
Dessa kan köras med hjälp av <a href="https://docs.npmjs.com/cli/v10/commands/npm-exec"><code>npm exec</code></a> eller <a href="https://docs.npmjs.com/cli/v10/commands/npx"><code>npx</code></a>.</p>

                <div
                    id="example-e7eaa0"
                    class="code-preview code-preview--default"
                    
                    
                    data-language="bash"
                >
                    
                    <pre class="code-preview__markup"><code class="hljs lang-bash" tabindex="0">npm <span class="hljs-built_in">exec</span> cypress open
</code></pre>
                </div>
            <p><code>cypress</code> är namnet på scriptet och resten av raden är CLI argumenten till scriptet.
Notera att precis som med parametrar till <code>npm run</code> måste parametrar med <code>--</code> föregås av ett extra <code>--</code>.</p>
<h3 id="lerna"><a class="header-anchor" href="#lerna">Lerna</a></h3><p>Vi använder <a href="https://lerna.js.org/">Lerna</a> för vissa operationer så som <code>npm run build</code> för att köra kommandon som kräver att paketen hanteras i topologisk ordning.</p>
<blockquote>
<p>Topologisk ordning: paketen bygger upp en riktad graf där noderna sorteras utifrån den ordning noderna måste besökas för alltid ha besökt dess beroenden innan sig själv.</p>
</blockquote>
<p>Exempelvis så är <code>npm run build</code> implementerat som:</p>

                <div
                    id="example-941c58"
                    class="code-preview code-preview--default"
                    
                    
                    data-language="json"
                >
                    
                    <pre class="code-preview__markup"><code class="hljs lang-json" tabindex="0"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">&quot;build&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lerna run build&quot;</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
                </div>
            <p>För att köra motsvarande med CLI:</p>

                <div
                    id="example-32d936"
                    class="code-preview code-preview--default"
                    
                    
                    data-language="bash"
                >
                    
                    <pre class="code-preview__markup"><code class="hljs lang-bash" tabindex="0">npm <span class="hljs-built_in">exec</span> lerna run build
</code></pre>
                </div>
            <p>Båda motsvarar då <code>npm run --workspaces build</code> fast garanterar att <code>build</code> anropats i en ordning som garanterar att beroenden byggts först.</p>
<h2 id="commits"><a class="header-anchor" href="#commits">Commits</a></h2><p>I FKUI använder vi commits som grund till både Changelog och för att automatiskt bestämma vilken nästkommande version blir.</p>
<p>Läs mer om hur <a href="#changelog">Changelog genereras från commits</a>.</p>
<p>Commitmeddelanden använder en modifierad variant av <a href="https://www.conventionalcommits.org/en/v1.0.0/">Conventional Commits</a> där skillnaden är att vi kräver en Jira-referens i slutet:</p>
<blockquote>
<p>${type}: ${description} (${relation} ${jira})</p>
</blockquote>
<p>där:</p>
<ul>
<li><code>${type}</code> är vilken typ av commit, vanligtvis <code>fix</code> eller <code>feat</code>.</li>
<li><code>${description}</code> är en kort summering av commit.</li>
<li><code>${relation}</code> är hur commit relaterat till en Jira, <code>refs</code> eller <code>fixes</code>.</li>
<li><code>${jira}</code> är den Jira som commit relaterar till.</li>
</ul>
<p>Scope sätter vi enbart i undantagsfall då det populeras automatiskt i Changelog.
Vanligt undantag är <code>chore(deps)</code> för beroenden, <code>chore(release)</code> för releaser samt <code>refactor(${verktyg})</code> och <code>style(${verktyg})</code>.</p>
<details style="border: 2px solid #eee; padding: 1.5rem; margin-bottom: 1rem;">
<summary style="cursor: pointer;">Tillgängliga typer</summary>
<p>De <code>${type}</code> vi använder är:</p>
<ul>
<li><code>fix</code> för buggrättningar.</li>
<li><code>feat</code> för nya features.</li>
<li><code>build</code> för ändringar av byggscript.</li>
<li><code>chore(deps)</code> för beroenden.</li>
<li><code>chore(release)</code> för releaser (ej manuellt).</li>
<li><code>chore</code> bör undvikas men tillåts för commits som inte passar in under andra typer.</li>
<li><code>ci</code> för ändringar av CI/CD-script.</li>
<li><code>docs</code> för ändringar av dokumentation.</li>
<li><code>style</code> för kosmetiska ändringar som ej påverkar konsumenter (dvs ej visuellt utseende).</li>
<li><code>refactor</code> för refaktorisering av kod som ej påverkar konsumenter.</li>
<li><code>perf</code> för ändingar som förbättrar prestanda men ej annars påverkar konsumenter.</li>
<li><code>test</code> för ändringar eller tillägg av testfall.</li>
</ul>
</details>
<p>Ett bra commitmeddelande ska:</p>
<ul>
<li>Beskriva vilken komponent eller funktion den berör. Skriv &quot;add new prop <code>foo</code> on component <code>FBar</code>&quot; istället för <code>&quot;add new prop&quot;</code> eller &quot;add new prop <code>foo</code>&quot; eftersom läsaren inte känner till sammanhanget.</li>
</ul>
<div class="row">
<div class="col col--md-6">

            <div class="docs-messagebox docs-messagebox--info">
                <p class="docs-messagebox__title">Bra meddelande</p>
                <ul>
<li>feat: add new prop <code>foo</code> on component <code>FBar</code></li>
<li>fix: fix styling issue when clicking on <code>FBaz</code></li>
</ul>

            </div>
        </div>
<div class="col col--md-6">

            <div class="docs-messagebox docs-messagebox--danger">
                <p class="docs-messagebox__title">Undvik</p>
                <ul>
<li>feat: add new prop</li>
<li>fix: fix styling</li>
</ul>

            </div>
        </div>
</div>
<p>Läs mer om <a href="#brytande-andringar">brytnade ändringar</a>.</p>
<p>Vi använder <a href="https://commitlint.js.org/">Commitlint</a> för att upprätthålla formatet på commitmeddelanden.
Commitlint anropas från git <code>commit-msg</code> hook (via <code>husky</code> från <code>.husky/commit-msg</code>) och är konfigurerat med att använda <a href="https://github.com/Forsakringskassan/commitlint-config"><code>@forsakringskassan/commitlint-config</code></a>.</p>
<p>Läs mer om <a href="#git-hooks">git hooks</a>.</p>
<p>Om det behövs kan man kringgå <code>commitlint</code> med <code>--no-verify</code>:</p>

                <div
                    id="example-278594"
                    class="code-preview code-preview--default"
                    
                    
                    data-language="bash"
                >
                    
                    <pre class="code-preview__markup"><code class="hljs lang-bash" tabindex="0">git commit --no-verify -m <span class="hljs-string">&#x27;non-conforming message&#x27;</span>
</code></pre>
                </div>
            <p>För feature-branches rekommenderar vi detta arbetsflödet för dina commits:</p>
<ol>
<li>För varje distinkt feature eller buggrättning, skapa en specifik och fristående commit (tänk på det som att den skulle gå att lägga en egen PR och mergas separat från övriga commits i din branch). Denna commit ska använda <code>feat</code> eller <code>fix</code> som type.</li>
<li>Behöver du bygga vidare på en tidigare commit (i din branch) kan du antingen använda <code>git commit --fixup</code> eller skapar en ny commit med <code>refactor</code> som type.</li>
<li>Innan det är dags för merge gör du en sista rebase över master där du slår ihop lämpliga commits, framförallt fixups men även de commits som använder <code>refactor</code> (var syfte inte är att göra en refaktorisering av kod som inte skapats i denna branch).</li>
</ol>
<h2 id="changelog"><a class="header-anchor" href="#changelog">Changelog</a></h2><p>Changelog genereras automatiskt med <a href="https://github.com/conventional-changelog/conventional-changelog">conventional-changelog</a> vid release.
Konfigurationen kommer från <a href="https://github.com/Forsakringskassan/semantic-release-config/blob/main/packages/semantic-release-common/lib/changelog.js">@forsakringskassan/semantic-release-config</a>.</p>
<p>Changelogen genereras utifrån en filtrerad lista med commits från föregående release.
De commits som tas hänsyn till är commits där commitmeddelande använder:</p>
<ul>
<li>Type <code>feat</code> (ny feature).</li>
<li>Type <code>fix</code> (buggrättning).</li>
<li>Type `perf (prestandaförbättring).</li>
<li>Type <code>revert</code> (revert av tidigare commit).</li>
<li>Commits som innehåller brytande ändringar. Läs mer om <a href="#brytande-%C3%A4ndringar">brytande ändringar</a>.</li>
</ul>
<p>Övriga commits visas ej i changelog.</p>
<p>Den filtrerade listan grupperas därefter efter typ:</p>
<ol>
<li>Brytande ändringar</li>
<li>Features</li>
<li>Buggrättningar</li>
</ol>
<p>Exempelvis om vi har följande lista med commits sen föregående release:</p>

                <div
                    id="example-27bb95"
                    class="code-preview code-preview--default"
                    
                    
                    data-language=""
                >
                    
                    <pre class="code-preview__markup"><code>fix: fix bug in component A (fixes XYZ-1234)
feat: new component B (refs XYZ-4321)
refactor: rewrite component C (refs XYZ-2345)
fix: fix another bug in component A (fixes XYZ-5432)
</code></pre>
                </div>
            <p>Efter filtrering kommer listan reduceras till:</p>

                <div
                    id="example-b6ff7c"
                    class="code-preview code-preview--default"
                    
                    
                    data-language=""
                >
                    
                    <pre class="code-preview__markup"><code>fix: fix bug in component A (fixes XYZ-1234)
feat: new component B (refs XYZ-4321)
fix: fix another bug in component A (fixes XYZ-5432)
</code></pre>
                </div>
            <p>Scope, om det inte explicit är satt, fylls i automatiskt:</p>

                <div
                    id="example-5e116d"
                    class="code-preview code-preview--default"
                    
                    
                    data-language=""
                >
                    
                    <pre class="code-preview__markup"><code>fix(@fkui/vue): fix bug in component A (fixes XYZ-1234)
feat(@fkui/design,@fkui/vue): new component B (refs XYZ-4321)
fix(@fkui/logic): fix another bug in component A (fixes XYZ-5432)
</code></pre>
                </div>
            <p>Efter gruppering kommer listan transformerats till:</p>

                <div
                    id="example-3f92ce"
                    class="code-preview code-preview--default"
                    
                    
                    data-language=""
                >
                    
                    <pre class="code-preview__markup"><code>feat:
  - feat(@fkui/design,@fkui/vue): new component B (refs XYZ-4321)

fix:
  - fix(@fkui/vue): fix bug in component A (fixes XYZ-1234)
  - fix(@fkui/logic): fix another bug in component A (fixes XYZ-5432)
</code></pre>
                </div>
            <p>och utifrån det genereras följande nya rader i Changelog:</p>

                <div
                    id="example-60851e"
                    class="code-preview code-preview--default"
                    
                    
                    data-language="md"
                >
                    
                    <pre class="code-preview__markup"><code class="hljs lang-md" tabindex="0"><span class="hljs-section">## v1.2.3 (1999-12-31)</span>

<span class="hljs-section">### Features</span>

<span class="hljs-bullet">-</span> <span class="hljs-strong">**@fkui/design**</span>, <span class="hljs-strong">**@fkui/vue**</span>: new component B (refs XYZ-4321)

<span class="hljs-section">### Bug fixes</span>

<span class="hljs-bullet">-</span> <span class="hljs-strong">**@fkui/vue**</span>: fix bug in component A (fixes XYZ-1234)
<span class="hljs-bullet">-</span> <span class="hljs-strong">**@fkui/logic**</span>: fix another bug in component A (fixes XYZ-5432)
</code></pre>
                </div>
            <p>Kom ihåg att om du använder squash merge för att merga din Pull Request så måste du skriva ett nytt commit-meddelande (i korrekt <a href="#commits">format</a>), använd inte det commitmeddelande som föreslås som default.</p>
<h2 id="release"><a class="header-anchor" href="#release">Release</a></h2><p>Vi använder <a href="https://semantic-release.gitbook.io/semantic-release">Semantic Release</a> med <a href="https://github.com/ext/semantic-release-lerna/"><code>semantic-release-lerna</code></a> för att hantera releaser.</p>
<p>Semantic release tar hand om:</p>
<ul>
<li>Välja ut nästa versionsnummer utifrån de commits som skapats sen föregående release.</li>
<li>Uppdatera <code>package.json</code> filer med nytt versionsnummer, inklusive beroenden mellan paket.</li>
<li>Vid behov, bygga om leverabler (leverabler som är beroende av ett uppdaterat versionsnummer).</li>
<li>Uppdatera Changelog.</li>
<li>Skicka ut announcement till chatt &quot;Ny release v1.2.3&quot;.</li>
<li>Publicera NPM-paket som ändrats sen föregående release, inklusive dependee paket.</li>
<li>Skapa tag i Git.</li>
</ul>
<p>Semantic release är konfigurerat med <code>@forsakringskassan/semantic-release-monorepo-config</code>, vars konfiguration ger:</p>
<ul>
<li>Versioner är latched på minor-versioner, dvs alla paket kommer alltid ha samma major och minor men patch tillåts ändras.</li>
<li>Nästkommande version använder <code>fix</code> för patch, <code>feat</code> för minor och breaking för major.</li>
<li>Vilka commits som är relevanta att visa i changelog och vilket stycke.</li>
</ul>
<p>Semantic release inspekterar taggar för att avgöra vilken den företående versionen är.</p>
<p>Vi går emot semantic release rekommendation och kör inte semantic-release vid varje commit på branchen utan vi triggar manuellt ett CI-jobb som kör semantic-release.
Motiveringen är att vårat arbetsflöde i git inte fungerar väl med att släppa löpande varje commit samt att det finns visst manuellt arbete som behöver utföras.</p>
<p>Läs mer om releaseprocess.</p>
<p>I FKUI använder vi <code>master</code> som primär branch och vanliga releaser utgår från den branchen.</p>
<h3 id="maintenance_releaser"><a class="header-anchor" href="#maintenance_releaser">Maintenance releaser</a></h3><p>Semantic release är konfigurerat att utöver <code>master</code> tillåta releaser från brancher likt <code>release/N.x</code> (exempelvis <code>release/4.x</code>).
Det innebär att major versionen kommer vara v4.
Det är viktigt att behålla branchen efteråt om man vill släppa fler releaser, behåller man inte den är det viktigt att senaste git taggen används när man skapar om branchen annars får man konflikter i versioner.</p>
<h2 id="git_hooks"><a class="header-anchor" href="#git_hooks">Git hooks</a></h2><p>Vi använder <code>husky</code> för att hantera git hooks, i <code>.husky</code> katalogen hittar du uppsättningen hooks som används.</p>
<ul>
<li><code>commit-msg</code> anropar <code>commitlint</code> för att validera formatet på commitmeddelande. Läs mer om commitlint.</li>
<li><code>pre-commit</code> anropar <code>lint-staged</code> för att automatiskt korrigera formatering med prettier samt korrigera eslint fel. Läs mer om statisk kodanalys.</li>
</ul>
<h2 id="vscode"><a class="header-anchor" href="#vscode">VSCode</a></h2><p>Vi använder Volar (<code>vue.volar</code>).</p>
<p>Workspace kommer med en lista med rekommenderade extensions och är förinställd att fungera med dessa.</p>
<h2 id="ci_cd"><a class="header-anchor" href="#ci_cd">CI/CD</a></h2><h2 id="underhall"><a class="header-anchor" href="#underhall">Underhåll</a></h2><p>I <code>scripts</code> finns repon lämpliga för diverse underhåll.
Se dokumentation för respektive vad de gör och hur det används.</p>


                    </div>
                </main>
            </div>

            <footer>
                <!-- prettier-ignore --><div class="footer__left">
    <h1>Kontakta oss</h1>
    <ul>
        <li><a class="anchor" href="mailto:designsystem@forsakringskassan.se">designsystem@forsakringskassan.se</a></li>
        <li><a class="anchor" href="../../gettingstarted/about/index.html">Om designsystemet</a></li>
    </ul>
</div>

<div class="footer__center"></div>

<div class="footer__right">
    <!-- prettier-ignore -->
    <div class="version">
    <!-- prettier-ignore -->
    docs/toolchain (<a href="https://github.com/Forsakringskassan/designsystem/commits/ee22059f2d2b7a7224b704e87170da3b730b294e">ee22059</a>)<br />
        <a href="https://github.com/Forsakringskassan/designsystem/pull/56">PR 56</a><br />
        2025-01-10 10:39
</div>
<div class="toolbar__item">
    <form id="version">
        <button type="submit">
            <span id="version-info" class="anchor"> Byt version </span>
        </button>
    </form>

    <dialog id="version-dialog">
        <div id="version-dialog-head">
            <h1>Välj version</h1>
            <button type="button" class="button button--discrete button--discrete--black">
                <span>Stäng</span>
                <svg class="button__icon icon f-icon-close" focusable="false" aria-hidden>
                    <use xlink:href="#f-icon-close"></use>
                </svg>
            </button>
        </div>
        <div id="version-list">
            <p>Var god vänta, laddar versionsdata...</p>
        </div>
    </dialog>
</div>

<template id="version-list-item">
    <li class="list__item">
        <a class="list__item__itempane">template</a>
    </li>
</template>


    <ul>
        <li><a class="anchor" href="../../changelog.html">Changelog</a></li>
        <li><a class="anchor" href="../../accessibility.html">Tillgänglighetsredogörelse</a></li>
        <li><a class="anchor" href="https://github.com/Forsakringskassan/designsystem">GitHub</a></li>
    </ul>
</div>
</footer>
        </div>

        <!-- prettier-ignore --><div aria-hidden="true" style="display: none">
    <svg xmlns="http://www.w3.org/2000/svg" focusable="false">
        <symbol id="docs-icon-search" viewBox="0 0 512 512">
            <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
            <path
                fill="currentColor"
                d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34M208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128"
            ></path>
        </symbol>
        <symbol id="docs-icon-close" viewBox="0 0 512 512">
            <path
                fill="currentColor"
                d="m322.72 256 100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L256 189.28 155.93 89.21c-12.28-12.28-32.19-12.28-44.48 0l-22.24 22.24c-12.28 12.28-12.28 32.19 0 44.48L189.28 256 89.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L256 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48z"
            ></path>
        </symbol>
        <symbol id="docs-icon-arrow-down" viewBox="0 0 512 512">
            <path
                fill="currentColor"
                d="M239.373 380.982 45.03 186.638c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04l154.746 154.021L411.089 129.99c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L273.315 380.982c-9.373 9.372-24.569 9.372-33.942 0"
            ></path>
        </symbol>
        <symbol id="docs-icon-circle" xml:space="preserve" viewBox="0 0 512 512">
            <path
                d="M489.5 256c0 129-104.6 233.5-233.5 233.5C127 489.5 22.5 385 22.5 256S127 22.5 256 22.5 489.5 127 489.5 256"
                style="fill: currentColor"
            ></path>
            <path
                d="M512 256c0 141.4-114.6 256-256 256S0 397.4 0 256 114.6 0 256 0s256 114.6 256 256M256 469.3c117.8 0 213.3-95.5 213.3-213.3S373.8 42.7 256 42.7 42.7 138.2 42.7 256 138.2 469.3 256 469.3"
                style="fill-rule: evenodd; clip-rule: evenodd"
            ></path>
        </symbol>
        <symbol id="docs-icon-i" xml:space="preserve" x="0" y="0" version="1.1" viewBox="0 0 512 512">
            <style>
                .i {
                    fill: currentColor;
                }
            </style>
            <path
                d="M228.25 243.12c0-15.33 12.42-27.75 27.75-27.75s27.75 12.43 27.75 27.75v117.19c0 15.33-12.43 27.75-27.75 27.75-15.33 0-27.75-12.43-27.75-27.75zM285.09 153.03c0 16.07-13.02 29.09-29.09 29.09s-29.09-13.02-29.09-29.09 13.02-29.09 29.09-29.09 29.09 13.02 29.09 29.09"
                class="i"
            ></path>
        </symbol>
    </svg>
</div>
<!-- prettier-ignore -->
        <dialog id="search-dialog">
    <!-- [html-validate-disable-next wcag/h32 -- handled via script] -->
    <form id="search-form">
        <div class="text-field">
            <label for="search-field" class="label"> Sök </label>
            <div class="text-field__input-wrapper">
                <div class="text-field__icon-wrapper">
                    <input
                        autofocus
                        autocomplete="off"
                        autocapitalize="off"
                        autocorrect="off"
                        id="search-field"
                        type="text"
                        class="text-field__input"
                        maxlength="50"
                        placeholder="Skriv för att börja söka"
                    />
                </div>
            </div>
        </div>
        <div id="search-results"></div>
        <p><kbd>Esc</kbd> för att stänga <kbd>Pil upp/ner</kbd> för att navigera <kbd>Enter</kbd> för att välja</p>
    </form>
</dialog>


        <!-- prettier-ignore -->
        <script
            src="../../assets/processors/motd/index-8c87e1.js"
            crossorigin
            integrity="sha384-VgbNs0pGkTPNii6sZDsQfyDa2hDTsNJePPW42/GgMW4jj8RspvO2p7e7j22mfz/b"
            
        ></script>
        <script
            src="../../assets/processors/selectable-version/select-version-5b4e65.js"
            crossorigin
            integrity="sha384-9hlga/vGl7mNJoNXoDuvw4YYU74V1PaTj5rmTtSAwXEVTHdcDfPKAwrUR+V8hrD0"
            
        ></script>
        <script
            src="../../assets/main-31401d.js"
            crossorigin
            integrity="sha384-bJFpu9DY6PkkKGSsSy/WBt9cLeRTwMIvTL16eqTkDtOjGVZnbuZuIWsFaU7rsiiw"
            
        ></script>
    </body>

    <!--

         Source file: docs/guide/toolchain/monorepo.md
         Document ID: fs:docs/guide/toolchain/monorepo.md
         Document name: monorepo
         Document alias: 

    -->
</html>
